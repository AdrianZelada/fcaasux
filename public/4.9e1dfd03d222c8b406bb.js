(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{lz7E:function(t,o,i){"use strict";i.r(o);var e=i("CcnG"),n=i("A1Tq"),a=12,s=9,r="#a8c479",l="#000",h="mainStation",p="littleStation",c=function(){function t(t,o){this.trains=[],this.id=t.id,this.label=t.name,this.x=t.position.x,this.y=t.position.y,this.size=t.main?a:s,this.type=t.main?h:p,this.color=t.main?r:l,this.trains=t.trains||[],this.main=t.main,this.index=o}return t.mainStation=function(t,o,i){var e=i("prefix")||"",n=t[e+"size"],a=o.measureText(t.id).width,s=o.measureText("8").width;o.beginPath(),o.fillStyle=t.color||i("defaultNodeColor"),o.setLineDash([]),o.lineWidth=4,o.strokeStyle="#000",o.arc(t[e+"x"],t[e+"y"],n,0,2*Math.PI),o.stroke(),o.fill(),o.beginPath(),o.fillStyle="#000",o.fillText(t.id,t[e+"x"]-a/2,t[e+"y"]+s/2),o.closePath(),o.fill(),o.restore()},t.littleStation=function(t,o,i){var e=i("prefix")||"",n=t[e+"size"],a=o.measureText(t.id).width,s=o.measureText("8").width;o.beginPath(),o.fillStyle="white",o.setLineDash([]),o.lineWidth=2,o.strokeStyle=t.color||i("defaultNodeColor"),o.arc(t[e+"x"],t[e+"y"],n,0,2*Math.PI),o.stroke(),o.restore(),o.fill(),o.beginPath(),o.fillStyle=t.color||i("defaultNodeColor"),o.fillText(t.id,t[e+"x"]-a/2,t[e+"y"]+s/2),o.closePath(),o.fill()},t}(),d="#26A65B",m="#d4d404",u=function(){function t(t){this.type="train",this.select=!1,this.id=t.id,this.label=t.name,this.x=t.x,this.y=t.y,this.size=t.size,this.main=!1,this.select=!1,this.travel=t.travel,this.color="up"==t.direction?d:m,this.direction=t.direction,this.state=t.state}return t.trainBoxCanvas=function(t,o,i){var e=i("prefix")||"",n=t[e+"size"],a=o.measureText(t.id).width,s=o.measureText("8").width;o.fillStyle=t.color||i("defaultNodeColor"),o.rect(t[e+"x"]-n,t[e+"y"]-n,2*n,2*n),o.fill(),o.beginPath(),o.fillStyle="white",o.fillText(t.id,t[e+"x"]-a/2,t[e+"y"]+s/2),o.closePath(),o.fill()},t.trainCanvas=function(t,o,i){var e=i("prefix")||"",n=t[e+"size"],a=o.measureText(t.id).width,s=o.measureText("8").width;"all"!=i("typeFilter")&&t.state!=i("typeFilter")||(o.beginPath(),o.lineWidth=.5,o.setLineDash([]),o.fillStyle=t.color||i("defaultNodeColor"),o.strokeStyle="#000",o.rect(t[e+"x"]-1.6*n,t[e+"y"]-n,3.2*n,1.5*n),o.stroke(),o.fill(),o.closePath(),"up"==t.direction?(o.beginPath(),o.fillStyle="#fff",o.moveTo(t[e+"x"]-1.6*n+(3.2*n-2),t[e+"y"]-n),o.lineTo(t[e+"x"]-1.6*n+3.2*n+3,t[e+"y"]-n+1.5*n/2),o.lineTo(t[e+"x"]-1.6*n+3.2*n-2,t[e+"y"]-n+1.5*n),o.stroke(),o.fill(),o.closePath(),o.beginPath(),o.font="10px Arial",o.fillStyle=t.select?"#EF4836":"white"):(o.beginPath(),o.fillStyle="#fff",o.moveTo(t[e+"x"]-1.6*n+2,t[e+"y"]-n),o.lineTo(t[e+"x"]-1.6*n-3,t[e+"y"]-n+1.5*n/2),o.lineTo(t[e+"x"]-1.6*n+2,t[e+"y"]-n+1.5*n),o.stroke(),o.fill(),o.closePath(),o.beginPath(),o.font="10px Arial",o.fillStyle=t.select?"#EF4836":"#000"),o.fillText(t.id,t[e+"x"]-a/2,t[e+"y"]+s/3),o.fill(),o.restore(),o.closePath())},t}(),y=function(){function t(t,o){this.size=8,this.type="rail",this.paintRail=!1,this.color="#fff",this.id=t.id,this.source=t.source,this.target=t.target,this.paintRail=!1,this.index=o}return t.railCanvas=function(t,o,i,e,n){var a=t.status,s=n("prefix")||"",r=null==t.status?n("edgeColor"):t.color,l=(n("defaultNodeColor"),n("defaultEdgeColor"),n("arrowColorUp")||"#000"),h=n("arrowColorBottom")||"#000";e.strokeStyle=r,e.lineWidth=t.size||1,e.setLineDash([]),e.beginPath(),e.moveTo(o[s+"x"],o[s+"y"]),e.lineTo(i[s+"x"],i[s+"y"]),e.stroke(),e.restore(),e.closePath();var p=function(t,o,i,e,n){var a=o+"x",s=o+"y",r=o+"size",l={headlen:10},h=0,p=1.5;return"landscape"==n("orientationScreen")?(i[a]!=e[a]&&i[s]!=e[s]?(h=t[r]/p,i[a]<e[a]&&i[s]>e[s]&&(h=-h)):p=1.3,l.up={from:{x:i[a]+h,y:i[s]-t[r]/p},to:{x:e[a]+h,y:e[s]-t[r]/p}},l.bottom={from:{x:i[a]-h,y:i[s]+t[r]/p},to:{x:e[a]-h,y:e[s]+t[r]/p}}):(i[a]!=e[a]&&i[s]!=e[s]&&(h=t[r]/2),l.up={from:{x:i[a]+t[r]/2,y:i[s]-h},to:{x:e[a]+t[r]/2,y:e[s]-h}},l.bottom={from:{x:i[a]-t[r]/2,y:i[s]+h},to:{x:e[a]-t[r]/2,y:e[s]+h}}),l}(t,s,o,i,n),c=n("sizeArrow")||3,d=n("widthArrow")||2,m=n("segmentedLine")||[3,3],u=n("routeCompletedColor")||"#3498DB",y=n("routeIncompleteColor")||"#F2784B",f={x:(p.up.from.x+p.up.to.x)/2,y:(p.up.from.y+p.up.to.y)/2};if(e.beginPath(),e.fillStyle=l,p.up.from.y==p.up.to.y)e.moveTo(f.x+c,f.y),e.lineTo(f.x-c,f.y-c),e.lineTo(f.x-c,f.y+c);else{var g=Math.atan((p.up.to.y-p.up.from.y)/(p.up.to.x-p.up.from.x))*(180/Math.PI),x=(Math.abs(Math.cos(0+g)*(f.x+c)-Math.sin(0+g)*f.y),Math.abs(Math.sin(0+g)*(f.x+c)+Math.cos(0+g)*f.y),Math.abs(Math.cos(0+g)*(f.x-c)-Math.sin(0+g)*(f.y-c)),Math.abs(Math.sin(0+g)*(f.x-c)+Math.cos(0+g)*(f.y-c)),Math.abs(Math.cos(0+g)*(f.x-c)-Math.sin(0+g)*(f.y+c)),Math.abs(Math.sin(0+g)*(f.x-c)+Math.cos(0+g)*(f.y+c)),new Path2D);x.moveTo(f.x+c,f.y),x.lineTo(f.x-c,f.y-c),x.lineTo(f.x-c,f.y+c)}e.fill(),e.restore(),e.closePath(),e.beginPath(),e.strokeStyle=l,e.lineWidth=d,e.setLineDash(m),e.moveTo(p.up.from.x,p.up.from.y),e.lineTo(p.up.to.x,p.up.to.y),e.stroke(),e.restore(),e.closePath();var b={x:(p.bottom.from.x+p.bottom.to.x)/2,y:(p.bottom.from.y+p.bottom.to.y)/2};e.beginPath(),e.fillStyle=h,p.bottom.from.y==p.bottom.to.y&&(e.moveTo(b.x-c,b.y),e.lineTo(b.x+c,b.y+c),e.lineTo(b.x+c,b.y-c)),e.fill(),e.restore(),e.closePath(),e.beginPath(),e.strokeStyle=h,e.lineWidth=d,e.setLineDash(m),e.moveTo(p.bottom.from.x,p.bottom.from.y),e.lineTo(p.bottom.to.x,p.bottom.to.y),e.stroke(),e.restore(),e.closePath(),"completed"==a&&(e.beginPath(),e.setLineDash([]),e.strokeStyle=u,e.lineWidth=4,e.moveTo(o[s+"x"],o[s+"y"]),e.lineTo(i[s+"x"],i[s+"y"]),e.stroke(),e.closePath()),"incomplete"==a&&(e.beginPath(),e.setLineDash([4,2]),e.strokeStyle=y,e.lineWidth=4,e.moveTo(o[s+"x"],o[s+"y"]),e.lineTo(i[s+"x"],i[s+"y"]),e.stroke(),e.restore(),e.closePath())},t}(),f=function(){function t(t,o,i){this.keyMap=t,this.stations=o,this.rails=i,this.graph={nodes:[],edges:[]},this.center={x:0,y:0},this.isViewComplate=!1,this.maxNodo=10,this.widthCanvas="",this.heightCanvas="",this.typeScreen=!0,this.initial=!0,this.currentStations=[],this._controlTime=0,this._lastTrain=0,this.colors={background:"#000",routeCompletedColor:"#00FFFF",routeIncompleteColor:"#FF7F50",edgeColor:"#fff",arrowColorUp:"#00FF00",arrowColorBottom:"#FFFF00"},this.graphCanvas={},this.stations=this._normalizeData(this.stations),this._resizeScreen(),this.zoomStatic=this._isMobile()?this._resize()<767?.4:.6:1,this.typeScreen=!0,sigma.canvas.nodes.train=u.trainCanvas,sigma.canvas.nodes.trainBox=u.trainBoxCanvas,sigma.canvas.nodes.mainStation=c.mainStation,sigma.canvas.nodes.littleStation=c.littleStation,sigma.canvas.edges.rail=y.railCanvas}return t.prototype.initMap=function(){this.graph={nodes:[],edges:[]},this._el=document.getElementById(this.keyMap),this._el.style.width=this.widthCanvas,this._el.style.height=this.heightCanvas,console.dir(this._el),this.graphCanvas={},this._drawStations(),this._drawRoutes(),console.log("this.graph"),console.log(this.graph),this.graphCanvas=new sigma({graph:this.graph,renderer:{container:this._el,type:"canvas"},settings:{minNodeSize:2,maxNodeSize:this.maxNodo,minEdgeSize:1,enableCamera:this._isMobile(),maxEdgeSize:10,drawLabels:!1,sideMargin:this._isMobile()?0:.3,isAnimated:!0,zoomingRatio:this.zoomStatic,zoomMin:this.zoomStatic,zoomMax:this.zoomStatic,defaultEdgeColor:"#fff",nodesPowRatio:.1,edgesPowRatio:.1,labelSize:"proportional",orientationScreen:this.typeScreen?"landscape":"portrail",isMobile:this._isMobile(),sizeArrow:4,typeFilter:"all",widthArrow:2,segmentedLine:[2,1],routeCompletedColor:this.colors.routeCompletedColor,routeIncompleteColor:this.colors.routeIncompleteColor,edgeColor:this.colors.edgeColor,arrowColorUp:this.colors.arrowColorUp,arrowColorBottom:this.colors.arrowColorBottom}}),setTimeout(function(){},5e3)},t.prototype.changeStation=function(t){console.log("this.graph.nodes[ind]"),console.log(this.graph.nodes[t]),this.graph.nodes[t].x=60,this.graphCanvas.refresh()},t.prototype._resize=function(){var t=document.body,o=document.documentElement;return Math.max(t.scrollWidth,t.offsetWidth,o.clientWidth,o.scrollWidth,o.offsetWidth)},t.prototype._normalizeData=function(t){return t.map(function(t){return t.position.x=parseFloat(t.position.x),t.position.y=parseFloat(t.position.y),t})},t.prototype._isMobile=function(){var t,o=!1;return t=navigator.userAgent||navigator.vendor,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(o=!0),o},t.prototype._resizeScreen=function(){this.widthCanvas=document.body.offsetWidth+"px",this.heightCanvas=document.body.offsetHeight-60+"px"},t.prototype._drawRoutes=function(){var t=this;this.rails.forEach(function(o,i){t.graph.edges.push(new y(o,i))})},t.prototype._drawStations=function(){var t=this;this.stations.forEach(function(o,i){o.trains&&t._drawTrains(o,function(o){t.graph.nodes.push(new u(o))}),t._constructCenter(o),t.graph.nodes.push(new c(o,i+1))})},t.prototype._drawTrains=function(t,o){var i,e,n,a,s,r,l,h=this,p=0,c=0,d=3;this._isMobile()?(d=2,this.typeScreen?(console.log("lands"),n=t.position.x-(i=.26),a=t.position.x-i,s=t.position.y-1.1*(e=.28),r=t.position.y+1.2*e,l=8):(console.log("port"),n=t.position.x+1.5*(i=.3),a=t.position.x-1.5*i,s=t.position.y-2*(e=.3),r=t.position.y-2*e,l=6)):(d=2,n=t.position.x-(i=.26),a=t.position.x-i,s=t.position.y-1.1*(e=.28),r=t.position.y+1.2*e,l=9),t.trains.forEach(function(m,u){var y,f,g=h.graphCanvas.settings?h.graphCanvas.settings("typeFilter"):"all";"all"!=g&&g!=m.state||(h.typeScreen?(h._isMobile(),"up"==m.direction?(p<d?(n+=i*(2*p),p++):(p=1,n=t.position.x-i,s-=e),y=n,f=s):(c<d?(a+=i*(2*c),c++):(c=1,a=t.position.x-i,r+=e),y=a,f=r)):"up"==m.direction?(++p<=d?s+=e:(p=0,s=t.position.y-e,n+=i),y=n,f=s):(++c<=d?r+=e:(c=0,r=t.position.y-e,a-=i),y=a,f=r),o(m={id:m.id,label:m.name,x:y,y:f,size:l,main:!1,type:"train",select:!1,travel:m.travel,color:"up"==m.direction?"#26A65B":"#d4d404",direction:m.direction,state:m.state}))})},t.prototype._constructCenter=function(t){this.center.x<t.position.x&&(this.center.x=t.position.x),this.center.y<t.position.y&&(this.center.y=t.position.y)},t}(),g=function(){function t(t){this._http=t}return t.prototype.ngOnInit=function(){var t=this;this._http.get("train.map").subscribe(function(o){setTimeout(function(){t.map=new f("trainMap",o.stations,o.routes),t.map.initMap()},1e3)})},t}(),x=function(){},b=i("pMnS"),v=e["\u0275crt"]({encapsulation:0,styles:[["#trainMap[_ngcontent-%COMP%]{background:#000}"]],data:{}});function w(t){return e["\u0275vid"](0,[(t()(),e["\u0275eld"](0,0,null,null,0,"div",[["id","trainMap"]],null,null,null,null,null))],null,null)}var C=e["\u0275ccf"]("app-train-control",g,function(t){return e["\u0275vid"](0,[(t()(),e["\u0275eld"](0,0,null,null,1,"app-train-control",[],null,null,null,w,v)),e["\u0275did"](1,114688,null,0,g,[n.a],null,null)],function(t,o){t(o,1,0)},null)},{},{},[]),k=i("Ip0R"),S=i("gIcY"),T=i("OzfB"),M=i("Fzqc"),z=i("21Lb"),P=i("hUWP"),_=i("3pJQ"),F=i("V9q+"),L=i("RaCk"),R=i("Tk7p"),A=i("5HBU"),D=i("ZYCi");i.d(o,"TrainControlModuleNgFactory",function(){return E});var E=e["\u0275cmf"](x,[],function(t){return e["\u0275mod"]([e["\u0275mpd"](512,e.ComponentFactoryResolver,e["\u0275CodegenComponentFactoryResolver"],[[8,[b.a,C]],[3,e.ComponentFactoryResolver],e.NgModuleRef]),e["\u0275mpd"](4608,k.NgLocalization,k.NgLocaleLocalization,[e.LOCALE_ID,[2,k["\u0275angular_packages_common_common_a"]]]),e["\u0275mpd"](4608,S.w,S.w,[]),e["\u0275mpd"](4608,S.e,S.e,[]),e["\u0275mpd"](4608,T.k,T.j,[T.d,T.h]),e["\u0275mpd"](5120,e.APP_BOOTSTRAP_LISTENER,function(t,o){return[T.n(t,o)]},[k.DOCUMENT,e.PLATFORM_ID]),e["\u0275mpd"](1073742336,k.CommonModule,k.CommonModule,[]),e["\u0275mpd"](1073742336,S.u,S.u,[]),e["\u0275mpd"](1073742336,S.k,S.k,[]),e["\u0275mpd"](1073742336,S.s,S.s,[]),e["\u0275mpd"](1073742336,T.e,T.e,[]),e["\u0275mpd"](1073742336,M.a,M.a,[]),e["\u0275mpd"](1073742336,z.c,z.c,[]),e["\u0275mpd"](1073742336,P.a,P.a,[]),e["\u0275mpd"](1073742336,_.a,_.a,[]),e["\u0275mpd"](1073742336,F.a,F.a,[[2,T.l],e.PLATFORM_ID]),e["\u0275mpd"](1073742336,L.a,L.a,[]),e["\u0275mpd"](1073742336,R.a,R.a,[]),e["\u0275mpd"](1073742336,A.a,A.a,[]),e["\u0275mpd"](1073742336,D.s,D.s,[[2,D.z],[2,D.p]]),e["\u0275mpd"](1073742336,x,x,[]),e["\u0275mpd"](1024,D.n,function(){return[[{path:"",component:g}]]},[])])})}}]);